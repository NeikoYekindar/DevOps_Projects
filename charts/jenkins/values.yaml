externalSecrets:
  # External secrets are disabled by default
  # Override in values-prod.yaml or values-staging.yaml to enable
  # enabled: false
  # secretPath: "jenkins/ENVIRONMENT/admin"  # Replace ENVIRONMENT with staging/production

  github:
    enabled: false
    secretPath: "jenkins/ENVIRONMENT/github/oauth"  # Replace ENVIRONMENT with staging/production

  sshEks:
    enabled: true
    secretPath: "jenkins/ssh/eks" 

  awsAccess:
    enabled: true
    secretPath: "jenkins/aws/access" 
    
  default:
    enabled: true
    secretPath: "jenkins/default/admin"


jenkins:
  jobdsls: []

  persistence:
    storageClass: gp3
    volumes:
      - name: jobdsl-scripts
        configMap:
          name: jobdsl-scripts
    mounts:
      - name: jobdsl-scripts
        mountPath: /var/jenkins_home/jobDSL

  controller:
    image:
      registry: "docker.io"
      repository: "jenkins/jenkins"
      tag: "lts-jdk21"

    # Install AWS CLI in Jenkins container
    initContainerEnv:
      - name: INSTALL_AWS_CLI
        value: "true"

    initScripts:
      install-aws-cli: |
        #!/bin/bash
        if [ "$INSTALL_AWS_CLI" = "true" ]; then
          echo "Installing AWS CLI..."
          cd /tmp
          apt-get update && apt-get install -y curl unzip
          curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
          unzip -q awscliv2.zip
          ./aws/install
          rm -rf aws awscliv2.zip
          echo "AWS CLI installed successfully"
          aws --version
        fi

    env:
      - name: AWS_ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: jenkins-aws-access-credential
            key: awsAccessKey
      - name: AWS_SECRET_KEY
        valueFrom:
          secretKeyRef:
            name: jenkins-aws-access-credential
            key: awsSecretKey
    
    controller:
      javaOpts: >-
        -Djenkins.install.runSetupWizard=false


    JCasC:
      defaultConfig: false
      configScripts:

        welcome-message: |
          jenkins:
            systemMessage: "Welcome to Jenkins Server"

        credentials-config: |
          credentials:
            system:
              domainCredentials:
                - credentials:
                    - basicSSHUserPrivateKey:
                        scope: GLOBAL
                        id: "ssh-eks-key"
                        description: "SSH key for EKS access"
                        username: "${jenkins-ssh-eks-credential.username}"
                        privateKeySource:
                          directEntry:
                            privateKey: "${jenkins-ssh-eks-credential.privateKey}"
                    - aws:
                        scope: GLOBAL
                        id: "aws-credentials"
                        description: "AWS Access Credentials"
                        accessKey: "${AWS_ACCESS_KEY}"
                        secretKey: "${AWS_SECRET_KEY}"

    resources:
      requests:
        cpu: "500m"
        memory: "1024Mi"
      limits:
        cpu: "1000m"
        memory: "2048Mi"

    # Use ClusterIP since we're using Traefik Ingress (not NodePort)
    serviceType: ClusterIP

    installLatestPlugins: false
    overwritePlugins: true
    installPlugins:
      - antisamy-markup-formatter:173.v680e3a_b_69ff3
      - apache-httpcomponents-client-4-api:4.5.14-269.vfa_2321039a_83
      - asm-api:9.9-185.va_6c6b_3348b_c3
      - authentication-tokens:1.131.v7199556c3004
      - bootstrap5-api:5.3.3-2
      - bouncycastle-api:2.30.1.80-261.v00c0e2618ec3
      - branch-api:2.1226.ve1e7e0b_4b_95f
      - caffeine-api:3.2.2-178.v353b_8428ed56
      - cloudbees-folder:6.1026.ve06dfa_cf31c3
      - commons-lang3-api:3.19.0-104.v12125f33a_255
      - commons-text-api:1.14.0-194.v804a_dc3a_1b_d8
      - configuration-as-code:2006.v001a_2ca_6b_574
      - credentials-binding:702.vfe613e537e88
      - credentials:1453.v9b_a_29777a_b_fd
      - aws-credentials
      - display-url-api:2.217.va_6b_de84cc74b_
      - durable-task:587.v84b_877235b_45
      - font-awesome-api:6.7.2-1
      - git-client:6.4.3
      - git:5.8.1
      - gson-api:2.13.2-173.va_a_092315913c
      - instance-identity:203.v15e81a_1b_7a_38
      - ionicons-api:94.vcc3065403257
      - jackson2-api:2.19.2-408.v18248a_324cfe
      - jakarta-activation-api:2.1.4-1
      - jakarta-mail-api:2.1.5-1
      - javax-activation-api:1.2.0-7
      - jaxb:2.3.9-133.vb_ec76a_73f706
      - job-dsl:1.93
      - joda-time-api:2.14.0-149.v1c3ce991d1b_9
      - json-api:20250517-173.v596efb_962a_31
      - kubernetes-client-api:7.3.1-256.v788a_0b_787114
      - kubernetes-credentials:203.v85b_9836a_f44b_
      - kubernetes:4398.vb_b_33d9e7fe23
      - mailer:522.va_995fa_cfb_8b_d
      - metrics:4.2.32-476.v5042e1c1edd7
      - mina-sshd-api-common:2.16.0-167.va_269f38cc024
      - mina-sshd-api-core:2.16.0-167.va_269f38cc024
      - okhttp-api:4.11.0-189.v976fa_d3379d6
      - pipeline-build-step:540.vb_e8849e1a_b_d8
      - pipeline-groovy-lib:752.vdddedf804e72
      - pipeline-input-step:534.v352f0a_e98918
      - pipeline-milestone-step:119.vdfdc43fc3b_9a_
      - pipeline-model-api:2.2277.v00573e73ddf1
      - pipeline-model-definition:2.2277.v00573e73ddf1
      - pipeline-model-extensions:2.2277.v00573e73ddf1
      - pipeline-stage-step:322.vecffa_99f371c
      - pipeline-stage-tags-metadata:2.2277.v00573e73ddf1
      - plain-credentials:199.v9f8e1f741799
      - plugin-util-api:6.1167.v022176c7e0ca_
      - prism-api:1.30.0-609.vf0a_df102d9a_f
      - scm-api:724.v7d839074eb_5c
      - script-security:1385.v7d2d9ec4d909
      - snakeyaml-api:2.3-125.v4d77857a_b_402
      - ssh-credentials:361.vb_f6760818e8c
      - structs:362.va_b_695ef4fdf9
      - variant:70.va_d9f17f859e0
      - workflow-aggregator:608.v67378e9d3db_1
      - workflow-api:1384.vdc05a_48f535f
      - workflow-basic-steps:1079.vce64b_a_929c5a_
      - workflow-cps:4238.va_6fb_65c1f699
      - workflow-durable-task-step:1458.va_2e10a_a_b_7c4d
      - workflow-job:1546.v62a_c59c112dd
      - workflow-multibranch:811.vcd33d074c2a_0
      - workflow-scm-step:466.va_d69e602552b_
      - workflow-step-api:710.v3e456cc85233
      - workflow-support:976.vb_d9493c2eb_09
      - ssh-agent:386.v36cc0c7582f0
      - github-api:1.330-492.v3941a_032db_2a_
      - json-path-api:2.10.0-202.va_9cc16c1e476
      - token-macro:477.vd4f0dc3cb_cf1
      - github:1.45.0
