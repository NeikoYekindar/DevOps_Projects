# ============================================================================
# Jenkins Staging Environment Configuration
# This file contains ONLY staging-specific configurations
# Common configurations are in values.yaml
# Usage: helm upgrade -f values.yaml -f values-staging.yaml
# ============================================================================

# externalSecrets:
#   github:
#     enabled: true
#     secretPath: "jenkins/staging/github/oauth"
#   sshEks:
#     enabled: true
#     secretPath: "jenkins/ssh/eks"
#   awsAccess:
#     enabled: true
#     secretPath: "jenkins/aws/access"
#   default:
#     enabled: true
#     secretPath: "jenkins/default/admin"

jenkins:
  persistence:
    size: "8Gi"  # Staging uses smaller storage

  controller:
    # Staging-specific URL
    jenkinsUrlProtocol: https
    jenkinsUrl: https://jenkins-staging.neikoscloud.net

    # Environment variables for staging
    # NOTE: This is an array, so it REPLACES the array in values.yaml (if any)
    containerEnv:
      - name: AWS_ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: jenkins-aws-access-credential
            key: awsAccessKey
      - name: AWS_SECRET_KEY
        valueFrom:
          secretKeyRef:
            name: jenkins-aws-access-credential
            key: awsSecretKey
      - name: SSH_USERNAME
        valueFrom:
          secretKeyRef:
            name: jenkins-ssh-eks-credential
            key: username
      - name: SSH_PRIVATE_KEY
        valueFrom:
          secretKeyRef:
            name: jenkins-ssh-eks-credential
            key: privateKey
      - name: GITHUB_CLIENT_ID
        valueFrom:
          secretKeyRef:
            name: jenkins-staging-github-oauth-secret
            key: clientId
      - name: GITHUB_CLIENT_SECRET
        valueFrom:
          secretKeyRef:
            name: jenkins-staging-github-oauth-secret
            key: clientSecret

    # JCasC configurations
    # NOTE: configScripts is an object/map, so it MERGES with values.yaml
    # Keys defined here will override keys in values.yaml
    JCasC:
      defaultConfig: true  # Enable JCasC to apply the configurations
      configScripts:
        # Override welcome message for staging
        welcome-message: |
          jenkins:
            systemMessage: "Welcome to Jenkins Staging Server"

        # Add GitHub OAuth security configuration
        security: |
          jenkins:
            securityRealm:
              github:
                githubWebUri: "https://github.com"
                githubApiUri: "https://api.github.com"
                clientID: "${GITHUB_CLIENT_ID}"
                clientSecret: "${GITHUB_CLIENT_SECRET}"
                oauthScopes: "read:org,user:email"

        # Credentials configuration (depends on containerEnv above)
        credentials-config: |
          credentials:
            system:
              domainCredentials:
                - credentials:
                    - basicSSHUserPrivateKey:
                        scope: GLOBAL
                        id: "ssh-eks-key"
                        description: "SSH key for EKS access"
                        username: "${SSH_USERNAME}"
                        privateKeySource:
                          directEntry:
                            privateKey: "${SSH_PRIVATE_KEY}"
                    - usernamePassword:
                        scope: GLOBAL
                        id: "aws-credentials"
                        description: "AWS Access Credentials"
                        username: "${AWS_ACCESS_KEY}"
                        password: "${AWS_SECRET_KEY}"